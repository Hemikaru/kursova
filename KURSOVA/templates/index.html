{% extends "layout.html" %}

{% block title %}–ì–æ–ª–æ–≤–Ω–∞{% endblock %}

{% block content %}
<div class="container">
  <h2 class="latest-topics-title">–û—Å—Ç–∞–Ω–Ω—ñ —Ç–µ–º–∏</h2>

  {% if threads %}
    {% for thread in threads %}
      <div class="thread-list-item d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center">
          <div class="thread-avatar me-3"></div>
          <div class="thread-content">
            <div class="d-flex align-items-center">
              <a href="{{ url_for('thread', thread_id=thread['id']) }}" class="thread-title">{{ thread['title'] }}</a>
              {% if loop.index0 == 0 %}
                <span class="thread-badge ms-2">–ù–æ–≤–µ</span>
              {% endif %}
            </div>
            <div class="thread-meta">
              –ê–≤—Ç–æ—Ä: {{ thread['username'] }} ‚Ä¢ ID —Ç–µ–º–∏: {{ thread['id'] }}
            </div>
          </div>
        </div>
        <div class="text-end">
          <button class="btn btn-sm btn-outline-success me-1" onclick="voteThread({{ thread.id }}, 1)">üëç</button>
          <span id="thread-votes-{{ thread.id }}">{{ thread.vote_count or 0 }}</span>
          <button class="btn btn-sm btn-outline-danger ms-1" onclick="voteThread({{ thread.id }}, -1)">üëé</button>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <p>–ù–µ–º–∞—î —Å—Ç–≤–æ—Ä–µ–Ω–∏—Ö —Ç–µ–º.</p>
  {% endif %}
</div>

<script>
  function voteThread(threadId, voteType) {
    fetch(`/vote/thread/${threadId}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ vote: voteType })
    })
    .then(res => res.json())
    .then(data => {
      document.getElementById(`thread-votes-${threadId}`).textContent = data.vote_count;
    });
  }
</script>
{% endblock %}
