<!doctype html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}–§–æ—Ä—É–º{% endblock %}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- ‚úÖ Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
  <header class="p-3 bg-dark text-white">
    <div class="container d-flex justify-content-between align-items-center">
      <h1 class="h3">–§–æ—Ä—É–º</h1>
      <nav class="d-flex gap-3 align-items-center">
        <a href="/" class="text-white text-decoration-none">–ì–æ–ª–æ–≤–Ω–∞</a>

        {% if session.get('username') %}
        <div class="user-nav d-flex align-items-center gap-2">
          <span>–ü—Ä–∏–≤—ñ—Ç, {{ session['username'] }}</span>

          <!-- üîî –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è -->
          <div class="notification-wrapper position-relative">
            <button class="notification-btn btn btn-sm btn-warning" onclick="toggleNotifications()">
              <i class="bi bi-bell-fill"></i>
            </button>
            <div class="notification-panel d-none bg-white text-dark position-absolute p-2 rounded shadow" id="notificationPanel" style="top: 40px; right: 0; width: 300px;">
              <p class="notif-title fw-bold mb-2">–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è</p>
              <div id="notifications-list">
                <p class="loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
              </div>
            </div>
          </div>

          <!-- üë§ –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ—Ñ—ñ–ª—é -->
          <a href="/profile" class="btn btn-sm btn-outline-info">–ü—Ä–æ—Ñ—ñ–ª—å</a>

          <a href="/create_thread" class="btn btn-sm btn-success">–°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–µ–º—É</a>
          <a href="/logout" class="btn btn-sm btn-outline-light">–í–∏–π—Ç–∏</a>
        </div>
        {% else %}
          <a href="/login" class="btn btn-sm btn-primary">–£–≤—ñ–π—Ç–∏</a>
          <a href="/register" class="btn btn-sm btn-secondary">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</a>
        {% endif %}
      </nav>
    </div>
  </header>

  <main class="container mt-4">
    {% block content %}{% endblock %}
  </main>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- üîî JS –¥–ª—è —Å–ø–æ–≤—ñ—â–µ–Ω—å -->
  <script>
    function toggleNotifications() {
      const panel = document.getElementById("notificationPanel");
      panel.classList.toggle("d-none");

      const list = document.getElementById("notifications-list");
      list.innerHTML = "<p class='loading'>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>";

      fetch("/notifications")
        .then(response => response.json())
        .then(data => {
          if (data.length === 0) {
            list.innerHTML = "<p class='no-notif'>–°–ø–æ–≤—ñ—â–µ–Ω—å –Ω–µ–º–∞—î.</p>";
          } else {
            list.innerHTML = "";
            data.forEach(notif => {
              const item = document.createElement("div");
              item.classList.add("notif-item");
              item.innerHTML = `<a href="/thread/${notif.thread_id}#comment-${notif.comment_id}">${notif.message}</a>`;
              list.appendChild(item);
            });
          }
        });
    }
  </script>
</body>
</html>
